import{fs as b,chalk as J}from"@vuepress/utils";import{Logger as R,isAbsoluteUrl as w,isUrl as y,getAuthor as A,getDate as P,stripTags as F}from"vuepress-shared";import M from"gray-matter";import{isLinkHttp as q,removeEndingSlash as D,removeLeadingSlash as W}from"@vuepress/shared";const p=new R("vuepress-plugin-seo2"),_=(e,t)=>Object.entries(t).map(([a,o])=>({localePath:a,lang:o.lang})).filter(a=>typeof a.lang=="string"&&a.lang!==e),E=({frontmatter:e},{hostname:t},{options:{base:a}})=>{const{banner:o,cover:n}=e;if(o){if(w(o))return $(t,a,o);if(y(o))return o}if(n){if(w(n))return $(t,a,n);if(y(n))return n}return null},T=({content:e},{hostname:t},{options:{base:a}})=>{const o=/!\[.*?\]\((.*?)\)/giu.exec(e);return o?o.map(([,n])=>w(n)?$(t,a,n):y(n)?n:null).filter(n=>n!==null):[]},$=(e,t,a)=>`${q(e)?D(e):`https://${D(e)}`}${t}${W(a)}`,z=(e="")=>e.replace(/<\/?.+?\/?>/g,""),K=e=>e?z(M(e).content).replace(/!\[(.*?)\]\(.*?\)/gm,"").replace(/```([\s\S]*?)```/g,"").replace(/^\s*:::\s*$/gm,"").replace(/^\s*:::\s*(.+?)(?:\s+(.*))?$/gm,"$2").replace(/^# (.*)$/gm,"$1").replace(/^#{1,6} (.*)$/gm,"$1").replace(/^\s*[-*+] (.*)$/gm,"$1; ").replace(/^\s*>+(.*)$/gm,'"$1"').replace(/(^|[^\\])\[(.*?)\]\(.*?\)/gm,"$1$2").replace(/`{1,2}([^`])(.*?)`{1,2}/g,"$1$2").replace(/~~(.*?)~~/g,"").replace(/(^|[^\\])([*|_]{1,2})(.*?)([^\\])\2/gm,"$1$3$4").replace(/<\/?.+?\/?>/g,"").split(`
`).map(t=>t.trim()).join(`
`).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim():"",j=(e,t,a="",o="")=>{t in e&&(p.error(`"${t}" is removed${o?`, please use ${o} instead.`:" and no longer supported"}${a?`
${a}`:""}`),o||delete e[t])},Q=e=>{j(e,"seo","","ogp"),j(e,"customMeta","","customHead")},V=(e,t,a)=>{var o,n,i;const{isArticle:l=c=>Boolean(c.filePathRelative&&!c.frontmatter.home)}=t,{options:{base:u},siteData:s}=a,{frontmatter:{author:g,time:S,date:m=S,tag:d,tags:f=d},data:{git:h={}}}=e,r=((o=s.locales[e.pathLocale])==null?void 0:o.title)||s.title||((n=s.locales["/"])==null?void 0:n.title)||"",B=g===!1?[]:A(g||t.author),{updatedTime:L}=h,x=L?new Date(L).toISOString():"",C=Array.isArray(f)?f:typeof d=="string"?[d]:[],I=e.title,G=E(e,t,a),H=T(e,t,a),N=_(e.lang,s.locales);let v="";if(m instanceof Date)v=new Date(m).toISOString();else if(m){const c=P(m);c&&c.value&&(v=c.value.toISOString())}const k=G||H[0]||t.fallBackImage||"";return{"og:url":$(t.hostname,u,e.path),"og:site_name":r,"og:title":I,"og:description":e.frontmatter.description||t.autoDescription&&e.frontmatter.summary||"","og:type":l(e)?"article":"website","og:image":k,"og:updated_time":x,"og:locale":e.lang,"og:locale:alternate":N.map(({lang:c})=>c),...t.restrictions?{"og:restrictions:age":t.restrictions}:{},...t.twitterID?{"twitter:creator":t.twitterID}:{},...k?{"twitter:card":"summary_large_image","twitter:image:alt":I}:{},"article:author":(i=B[0])==null?void 0:i.name,"article:tag":C,"article:published_time":v,"article:modified_time":x}},X=(e,t,a)=>{const{isArticle:o=r=>Boolean(r.filePathRelative&&!r.frontmatter.home)}=t,{frontmatter:{author:n,time:i,date:l=i},data:{git:u={}}}=e,s=n===!1?[]:A(n||t.author),{updatedTime:g}=u,S=g?new Date(g).toISOString():"",m=e.title,d=E(e,t,a),f=T(e,t,a);let h="";if(l instanceof Date)h=new Date(l).toISOString();else if(l){const r=P(l);r&&r.value&&(h=r.value.toISOString())}return o(e)?{"@context":"https://schema.org","@type":"NewsArticle",headline:m,image:f.length?f:[d||t.fallBackImage||""],datePublished:h,dateModified:S,author:s.map(r=>({"@type":"Person",...r}))}:null},Y=(e,t)=>typeof t.canonical=="function"?t.canonical(e):typeof t.canonical=="string"?`${D(t.canonical)}${e.path}`:null,Z=(e,t)=>_(e.lang,t.siteData.locales).map(({lang:a,localePath:o})=>({lang:a,path:`${o}${e.path.replace(e.pathLocale,"")}`})),O=(e,{name:t,content:a,attribute:o=["article:","og:"].some(n=>t.startsWith(n))?"property":"name"})=>{a&&e.push(["meta",{[o]:t,content:a}])},ee=(e,t)=>{for(const a in t)switch(a){case"article:tag":t["article:tag"].forEach(o=>O(e,{name:"article:tag",content:o}));break;case"og:locale:alternate":t["og:locale:alternate"].forEach(o=>{o!==t["og:locale"]&&O(e,{name:"og:locale:alternate",content:o})});break;default:t[a]&&O(e,{name:a,content:t[a]})}},te=(e,t)=>{t&&e.push(["script",{type:"application/ld+json"},JSON.stringify(t)])},ae=(e,t)=>{t&&e.push(["link",{rel:"canonical",href:t}])},oe=(e,t)=>{t.forEach(({lang:a,path:o})=>{e.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:o}])})},ne=(e,t,a)=>{const o=e.frontmatter.head||[],n=V(e,t,a),i=X(e,t,a),l=t.ogp?t.ogp(n,e,a):n,u=t.jsonLd?t.jsonLd(i,e,a):null,s=Y(e,t),g=Z(e,a);ee(o,l),te(o,u),ae(o,s),oe(o,g),t.customHead&&t.customHead(o,e,a),e.frontmatter.head=o},re=async e=>{p.load("Generating robots.txt");const t=e.public("robots.txt");let a=b.existsSync(t)?await b.readFile(t,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(p.error(),p.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await b.writeFile(e.dest("robots.txt"),a,{flag:"w"}),p.succeed())},U=(e,t=!1)=>a=>{t&&Q(e),a.env.isDebug&&p.info(`Options: ${e.toString()}`);const o={name:"vuepress-plugin-seo2"};return e.hostname?{...o,extendsPage:(n,i)=>{n.frontmatter.description||(n.frontmatter.summary=F(n.excerpt)||K(n.content).slice(0,180)||""),ne(n,e,i)},onGenerated:n=>re(n.dir)}:(p.error(`Option ${J.magenta("hostname")} is required!`),o)};export{U as default,U as seoPlugin};
//# sourceMappingURL=index.js.map
